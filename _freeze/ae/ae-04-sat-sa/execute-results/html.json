{
  "hash": "4226d68646b9f5119474bebd53a1a82f",
  "result": {
    "markdown": "---\ntitle: \"Visualizing data and investigating relationships\"\ncategories: \n  - Application exercise\neditor: visual\neditor_options: \n  chunk_output_type: console\n---\n\n\n::: callout-important\nThese are suggested answers to the application exercise. They may differ slightly from the code we developed in class and may not be complete. They're provided after class to help review the application activity, but are not an alternative to working on the exercise and actively participating in class.\n:::\n\n# Goals\n\nThe main question we'll explore today is \"How are SAT scores and teacher salaries associated?\" What do you think?\n\nAlong the way we will:\n\n-   create data visualizations and calculating summary statistics for comparing trends across groups\n\n-   distinguish observational studies and experiments\n\n-   identify confounding variables and Simpson's paradox\n\n# Data and packages\n\nFor this application exercise we'll use the `SAT_2010` from the **mdsr** package, which includes information on average SAT scores, average teacher salaries, and percentage of students taking SAT for each state. The data are from 2010.\n\nLet's first load the packages we'll use:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(mdsr)      # for the data\nlibrary(tidyverse) # for data visualization and wrangling\nlibrary(scales)    # for better axis labels\nlibrary(ggthemes)  # for better colors\nlibrary(ggrepel)   # for avoiding ovarlap in plots\n```\n:::\n\n\n## Single variable\n\nAnalyzing the a single variable is called **univariate** analysis.\n\nCreate visualizations of the distribution of average SAT scores, `total`.\n\n1.  Make a histogram. Set an appropriate binwidth.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(SAT_2010, aes(x = total)) +\n  geom_histogram(binwidth = 40)\n```\n\n::: {.cell-output-display}\n![](ae-04-sat-sa_files/figure-html/score-hist-1.png){width=672}\n:::\n:::\n\n\n2.  Make a boxplot.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(SAT_2010, aes(x = total)) +\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](ae-04-sat-sa_files/figure-html/score-box-1.png){width=672}\n:::\n:::\n\n\n3.  Make a density plot.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(SAT_2010, aes(x = total)) +\n  geom_density(fill = \"gray\")\n```\n\n::: {.cell-output-display}\n![](ae-04-sat-sa_files/figure-html/score-density-1.png){width=672}\n:::\n:::\n\n\n4.  Based on these, determine if each of the following statements about the shape of the distribution is true or false.\n\n    -   The distribution of average SAT scores in 2010 is right skewed. \\_\\_\\_\n\n    -   The distribution of average SAT scores in 2010 is unimodal. \\_\\_\\_\n\n## Two variables\n\nAnalyzing the relationship between two variables is called **bivariate** analysis.\n\n5.  What would you expect the relationship between average SAT scores (`total`) and average teacher salaries (`salary`) to look like? What type of plot would you use to visualize this relationship? Create the plot below.\n\n*Add your answer here.*\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(SAT_2010, aes(x = salary, y = total)) + \n  geom_point() + \n  geom_smooth(method = \"lm\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](ae-04-sat-sa_files/figure-html/score-salary-1.png){width=672}\n:::\n:::\n\n\n6.  Lurking in the background, however, is another important factor. The percentage of students who take the SAT in each state varies dramatically between states. First, let's visualize the distribution of this variable, `sat_pct`.\n\n*Add your response here.*\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(SAT_2010, aes(x = sat_pct)) +\n  geom_histogram()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](ae-04-sat-sa_files/figure-html/sat-pct-hist-1.png){width=672}\n:::\n:::\n\n\n7.  Let's label states with low SAT participation `\"Low\"` and the others `\"High\"`. For the cutoff point, let's use the median participation level.\n\n*Add your response here.*\n\n\n::: {.cell}\n\n```{.r .cell-code}\nSAT_2010 |>\n  summarize(med = median(sat_pct))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  med\n1  27\n```\n\n\n:::\n\n```{.r .cell-code}\nSAT_2010 <- SAT_2010 |>\n  mutate(sat_pct_grp = ifelse(sat_pct <= 27, \"Low\", \"High\"))\n```\n:::\n\n\n## Multiple variables\n\n8.  Recreate the scatterplot of average SAT scores, this time coloring each state based on whether they had low or high participation in the SAT. Describe the relationship between SAT scores and teacher salaries, when *conditioning on* SAT participation.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(SAT_2010, aes(x = salary, y = total, color = sat_pct_grp)) + \n  geom_point() + \n  geom_smooth(method = \"lm\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](ae-04-sat-sa_files/figure-html/score-salary-grp-1.png){width=672}\n:::\n:::\n\n\n9.  Fill in the blanks below.\n    -   Among all states, salaries and SAT scores are \\_\\_\\_ associated.\n\n    -   Among states with a low percentage taking the SAT, teacher salaries and SAT scores are \\_\\_\\_ associated.\n\n    -   Among states with a high percentage taking the SAT, teacher salaries and SAT scores are \\_\\_\\_ associated.\n\nThis phenomenon is called **Simpson's paradox** -- a trend appears in subsets of the data, but disappears or reverses when the subsets are combined. The paradox can be resolved when **confounding variables** and causal relations are appropriately addressed in the analysis. In the above example, the confounding variable is SAT participation rate.\n\n10. Improve the visual display of the plot you just created.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(SAT_2010, aes(x = salary, y = total, color = sat_pct_grp)) + \n  geom_point() + \n  geom_smooth(method = \"lm\") +\n  labs(\n    x = \"Average teacher salary ((in 2010 US $)\",\n    y = \"Average total score on the SAT\",\n    color = \"SAT participation rate\",\n    title = \"Average SAT scores and teacher salaries in US States\"\n  ) +\n  scale_color_colorblind(labels = c(\"Low (27%)\", \"High (>27%)\")) +\n  scale_x_continuous(labels = label_dollar(scale = 1/1000, suffix = \"K\")) +\n  theme_minimal() +\n  theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](ae-04-sat-sa_files/figure-html/score-salary-grp-improved-1.png){width=672}\n:::\n:::\n\n\n# Looking forward\n\nBelow is an example of a type of plot you'll be making soon! Review the plot and the code. How is it different from what we had before? What aspects of it do you like better? Are there any aspects you don't like? Are there any features of the plot that you can identify the corresponding code for? Are there any features that you can't identify the code for and you'd like to learn?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstates <- tibble(\n  state_name = state.name,\n  state_abb = state.abb\n)\n\nSAT_2010 |>\n  left_join(states, by = join_by(state == state_name)) |>\n  ggplot(aes(x = salary, y = total, color = sat_pct_grp)) + \n  geom_smooth(method = \"lm\", se = FALSE) +\n  geom_point() +\n  geom_label_repel(aes(label = state_abb), alpha = 0.7, show.legend = FALSE) + \n  labs(\n    x = \"Average teacher salary (in 2010 US $)\",\n    y = \"Average total score on the SAT\",\n    color = \"SAT participation rate\",\n    title = \"Average SAT scores and teacher salaries in US States\"\n  ) +\n  scale_color_colorblind(labels = c(\"Low (27%)\", \"High (>27%)\")) +\n  scale_x_continuous(labels = label_dollar(scale = 1/1000, suffix = \"K\")) +\n  theme_minimal() +\n  theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](ae-04-sat-sa_files/figure-html/text-labels-1.png){width=768}\n:::\n:::\n",
    "supporting": [
      "ae-04-sat-sa_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}